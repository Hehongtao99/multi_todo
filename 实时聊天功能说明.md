# 实时聊天功能说明

## 功能概述

本次新增了实时聊天功能，支持管理员与系统中的普通用户进行实时聊天通信。

## 功能特点

### 1. 权限控制
- 所有用户都可以访问聊天功能
- 管理员可以看到所有普通用户列表，与普通用户聊天
- 普通用户可以看到所有管理员列表，与管理员聊天

### 2. 实时通信
- 基于WebSocket实现实时聊天
- 消息即时发送和接收
- 支持消息状态显示（已读/未读）

### 3. 用户界面
- 左侧显示用户列表
- 右侧显示聊天区域
- 支持用户在线状态显示
- 未读消息数量提醒

### 4. 消息持久化
- 聊天消息保存到数据库
- 支持聊天记录查询
- 消息已读状态管理

## 技术实现

### 前端
- **Chat.vue**: 聊天页面主组件
- **chat.js**: 聊天相关API接口
- **websocket.js**: WebSocket连接和消息处理（扩展）

### 后端
- **ChatController**: 聊天功能控制器
- **ChatService**: 聊天业务逻辑服务
- **ChatMessage**: 聊天消息实体
- **ChatMessageMapper**: 聊天消息数据访问层

### 数据库
- **chat_message表**: 存储聊天消息记录

## 使用说明

### 1. 访问聊天功能
1. 登录系统（管理员或普通用户）
2. 在左侧菜单中点击"实时聊天"
3. 进入聊天页面

### 2. 开始聊天
1. 在左侧用户列表中选择要聊天的用户
2. 在右侧输入框中输入消息
3. 点击"发送"按钮或按回车键发送消息

### 3. 消息管理
- 查看聊天记录：选择用户后自动加载历史消息
- 未读消息提醒：用户列表显示未读消息数量
- 消息状态：自动标记消息为已读

## 数据库更新

需要执行以下SQL脚本创建聊天消息表：

```sql
-- 执行 create_chat_table.sql 文件中的SQL语句
```

## 注意事项

1. 确保WebSocket连接正常工作
2. 聊天功能目前仅支持管理员使用
3. 消息内容最大长度为500字符
4. 聊天记录永久保存在数据库中

## 后续扩展建议

1. 支持普通用户之间互相聊天
2. 添加文件和图片发送功能
3. 消息撤回功能
4. 聊天记录导出功能
5. 消息推送通知优化 