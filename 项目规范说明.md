# 多人待办项目 - 开发规范

## Controller层规范

### 1. 入参规范
- **Controller层的所有方法入参必须是DTO对象**
- 禁止使用`@PathVariable`、`@RequestParam`、`@RequestHeader`等单独参数
- 所有请求参数（包括路径参数、查询参数、请求头）都必须封装在DTO中

### 2. 返参规范
- **Controller层的所有方法返参必须是VO对象**
- 禁止直接返回Entity实体类
- 统一使用`Result<VO>`格式返回

### 3. 业务逻辑规范
- **Controller层不能包含任何业务逻辑**
- Controller层只负责接收请求和返回响应
- 所有业务逻辑必须在Service层实现

### 4. HTTP方法规范
- 统一使用POST方法（根据项目需求）
- 避免使用GET、PUT、DELETE等方法

## 示例对比

### ❌ 错误示例
```java
@GetMapping("/user/{userId}")
public Result<User> getUser(@PathVariable Long userId, 
                           @RequestHeader("userAuth") String userAuth) {
    // 包含业务逻辑
    if (!"admin".equals(userAuth)) {
        return Result.error("权限不足");
    }
    User user = userService.getUser(userId);
    return Result.success(user); // 直接返回Entity
}
```

### ✅ 正确示例
```java
@PostMapping("/user")
public Result<UserVo> getUser(@RequestBody UserQueryDto queryDto) {
    UserVo result = userService.getUser(queryDto);
    return Result.success(result);
}
```

## DTO设计规范

### 1. 命名规范
- 查询类：`XxxQueryDto`
- 创建类：`XxxCreateDto` 或 `XxxCreateRequestDto`
- 更新类：`XxxUpdateDto`
- 删除类：`XxxDeleteDto`
- 通用请求类：`XxxRequestDto`

### 2. 字段设计
- 包含所有必要的请求参数
- 包含权限验证相关字段（如userId、userAuth）
- 使用合适的数据类型和验证注解

## VO设计规范

### 1. 命名规范
- 实体视图：`XxxVo`
- 操作结果：`OperationResultVo`
- 计数结果：`XxxCountVo`
- 列表包装：`XxxListVo`（如需要）

### 2. 字段设计
- 只包含前端需要的字段
- 隐藏敏感信息（如密码）
- 格式化时间、状态等字段

## Service层规范

### 1. 接口设计
- 方法参数使用DTO
- 方法返回使用VO
- 包含所有业务逻辑

### 2. 实现规范
- 进行权限验证
- 处理异常情况
- 实体与VO之间的转换

## 重构进度

### ✅ 已完成
1. **Controller层重构**
   - UserController：统一使用DTO入参、VO返参
   - ProjectController：统一使用DTO入参、VO返参
   - NotificationController：统一使用DTO入参、VO返参

2. **DTO类创建**
   - UserListQueryDto
   - ProjectListQueryDto、ProjectDetailQueryDto
   - ProjectCreateRequestDto、ProjectAssignRequestDto
   - NotificationSendDto、NotificationQueryDto、NotificationMarkReadDto、NotificationDeleteDto

3. **VO类创建**
   - UserVo
   - OperationResultVo
   - NotificationCountVo

### ✅ 新完成
4. **Service层实现更新**
   - UserServiceImpl：已完成方法签名更新和实现重构
   - ProjectServiceImpl：已完成方法签名更新和实现重构
   - NotificationServiceImpl：已完成方法签名更新和实现重构
   - TodoServiceImpl：已完成方法签名更新和实现重构

5. **DTO类补充**
   - TodoQueryDto：查询待办事项的DTO
   - TodoDeleteDto：删除待办事项的DTO
   - 为RegisterDto、TodoCreateDto、TodoUpdateDto添加权限验证字段

6. **实体与VO转换**
   - 添加EntityVoConverter工具类进行对象转换
   - 确保敏感信息不泄露（如密码字段）

7. **异常处理优化**
   - 添加GlobalExceptionHandler全局异常处理器
   - 统一异常处理机制和错误返回格式

### 🚧 待完成

## 注意事项

1. **向后兼容**：在Service层实现更新时，确保不破坏现有功能
2. **权限验证**：将Controller层的权限验证逻辑移到Service层
3. **异常处理**：Service层抛出的异常应该被全局异常处理器捕获
4. **性能考虑**：对象转换应该高效，避免过度的反射操作

## 下一步计划

1. ✅ 更新Service层实现，完成方法签名和逻辑迁移
2. ✅ 添加对象转换工具类或配置
3. ✅ 完善异常处理机制
4. 更新前端API调用以适配新的接口规范
5. 编写单元测试验证重构结果
6. 添加WebSocketService测试方法的DTO规范重构 